<!-- templates/intro-story.html -->
<!doctype html>
<html lang="en">
<head>
  {% load static %}
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NOMY • Intro</title>

  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet" />

  <style>
    :root{
      --ink:#1f003d;
      --muted:#4b3970;
      --card-bg:rgba(255,255,255,.15);
      --shadow:0 18px 40px rgba(17,12,40,.10);
    }

    *{box-sizing:border-box;}
    html,body{
      height:100%;
      margin:0;
      font-family:"DM Sans",sans-serif;
      color:var(--ink);
      background:url("{% static 'images/bg.png' %}") center/cover no-repeat fixed;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding:8vh 4vw;
    }

    .story__progress{
      position:fixed;
      top:60px;
      left:50%;
      transform:translateX(-50%);
      display:flex;
      gap:8px;
      width:min(280px,60vw);
      z-index:10;
    }
    .bar{
      flex:1;height:6px;background:rgba(255,255,255,.4);border-radius:999px;overflow:hidden;
    }
    .bar__fill{
      height:100%;width:0;background:var(--ink);border-radius:inherit;transition:width .25s ease;
    }

    .slides{
      width:min(720px,90vw);
      text-align:center;
    }

    .slide{display:none;animation:fade .35s ease;}
    .slide.is-active{display:block;}

    @keyframes fade{
      from{opacity:.001;transform:translateY(6px);}
      to{opacity:1;transform:none;}
    }

    .card{
      position:relative;
      background:var(--card-bg);
      backdrop-filter:blur(10px);
      border-radius:24px;
      box-shadow:var(--shadow);
      padding:4rem 3rem;
      line-height:1.4;
      font-size:1rem;
      width:100%;
      max-width:700px;
      height:380px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      margin:0 auto;
      overflow:hidden;
    }

    .card::before{
      content:"";position:absolute;inset:0;border-radius:inherit;background:rgba(255,255,255,0.25);pointer-events:none;z-index:0;
    }

    .card p{margin:1.5rem 0;position:relative;z-index:1;color:var(--ink);}
    strong{font-weight:700;}

    .footer{
      position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
      font-size:14px;color:var(--muted);
    }

    @media (max-width: 768px) {
      body { justify-content:flex-start; padding-top:8vh; }
      .slides { overflow-y:auto; max-height:100vh; }
      .card { padding:3rem 1.5rem; height:360px; }
    }

    .tap{
      position:fixed;inset:0;display:grid;grid-template-columns:1fr 1fr;z-index:5;
    }
    .tap>button{background:none;border:0;padding:0;cursor:pointer;}

    /* ---------------------------------------- */
    /*        FIXED SLIDE 2 FEATURE LAYOUT      */
    /* ---------------------------------------- */

    .features-container {
      margin-top: 1rem;
      display: flex;
      flex-direction: column;
      gap: 6px;
      width: 100%;
      max-width: 420px;
      margin-left: auto;
      margin-right: auto;
      text-align: left; /* fixes main issue */
    }

    .feature-row {
      display: flex;
      align-items: center;
      gap: 18px;
    }

    .pill {
      text-align: center;
      display: inline-flex;     
      justify-content: center;   
      align-items: center;
      width: 130px;
      padding: 12px 28px;
      border-radius: 50px;
      font-weight: 500;
      font-size: 0.95rem;
      white-space: nowrap;
    }

    .pill-1 { background:#e9c3f1; }
    .pill-2 { background:#e1dcf9; }
    .pill-3 { background:#f1f1ff; }
    .pill-4 { background:#fff5e9; }

    /* Waitlist-style button */
    .enter-btn {
      width: 100%;
      max-width: 260px;
      padding: 15px;
      border: none;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--accent), #d6c2f3);
      color: #fff;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      transition: transform .15s ease, background .2s ease;
      margin: 24px auto 0;
      display: none; /* shown only on last slide */
    }

    .enter-btn:hover {
      transform: translateY(-1px);
      background: linear-gradient(135deg, #a59bf5, #c9b4f0);
    }
  </style>
</head>

<body>
  <div class="story__progress" id="progress"></div>

  <section class="slides" id="slides">

    <!-- Slide 1 -->
    <article class="slide is-active">
      <div class="card">
        <p>You’ve just entered a space built differently on purpose.</p>
        <p>A space that understands the quiet exhaustion of always trying to fit into systems that weren’t made with your mind in mind.</p>
        <p>Here, you don’t have to mask, explain or perform.</p>
        <p>You get to <strong>simply be</strong> and explore who that really is.</p>
      </div>
    </article>

    <!-- Slide 2 — FIXED -->
    <article class="slide">
      <div class="card">
        <p><strong>NOMY</strong> is here to help you reconnect with yourself and meet yourself with understanding, maybe for the first time.</p>

        <div class="features-container">

          <div class="feature-row">
            <div class="pill pill-1">Emotionize</div>
            <span><em>understand your feelings.</em></span>
          </div>

          <div class="feature-row">
            <div class="pill pill-2">Express</div>
            <span><em>create, reflect, and release.</em></span>
          </div>

          <div class="feature-row">
            <div class="pill pill-3">Dailies</div>
            <span><em>set gentle goals for your day.</em></span>
          </div>

          <div class="feature-row">
            <div class="pill pill-4">Toolkit</div>
            <span><em>find calm when things feel too much.</em></span>
          </div>

        </div>
      </div>
    </article>

    <!-- Slide 3 -->
    <article class="slide">
      <div class="card">
        <p>Welcome home.</p>
      </div>
    </article>

  </section>

  <div class="tap" aria-hidden="true">
    <button id="prev" title="Previous"></button>
    <button id="next" title="Next"></button>
  </div>

  <div class="footer">Tap anywhere → to continue</div>

  <script>
    (function () {
      const slides = Array.from(document.querySelectorAll('.slide'));
      const progressRoot = document.getElementById('progress');
      const prevBtn = document.getElementById('prev');
      const nextBtn = document.getElementById('next');
      const footer = document.querySelector('.footer');

      slides.forEach(() => {
        const bar = document.createElement('div');
        bar.className = 'bar';
        const fill = document.createElement('div');
        fill.className = 'bar__fill';
        bar.appendChild(fill);
        progressRoot.appendChild(bar);
      });

      const fills = Array.from(document.querySelectorAll('.bar__fill'));
      let i = 0;

      function render(n) {
        i = Math.max(0, Math.min(slides.length - 1, n));
        slides.forEach((el, idx) => el.classList.toggle('is-active', idx === i));
        fills.forEach((f, idx) => f.style.width = idx <= i ? '100%' : '0%');
        footer.textContent = i === slides.length - 1 ? 'Tap to enter NOMY' : 'Tap anywhere → to continue';
      }

      function next() {
        if (i === slides.length - 1) {
          window.location.href = "{% url 'nomy-options' %}";
        } else { render(i + 1); }
      }

      function prev() { render(i - 1); }

      nextBtn.addEventListener('click', next);
      prevBtn.addEventListener('click', prev);

      window.addEventListener('keydown', e => {
        if (e.key === 'ArrowRight') next();
        if (e.key === 'ArrowLeft') prev();
      });

      let startX = null;
      window.addEventListener('touchstart', e => { startX = e.touches[0].clientX; }, { passive:true });
      window.addEventListener('touchend', e => {
        if (startX == null) return;
        const dx = e.changedTouches[0].clientX - startX;
        if (Math.abs(dx) > 40) (dx < 0 ? next() : prev());
        startX = null;
      });

      render(0);
    })();
  </script>
  
</body>
</html>
