<!-- templates/intro-story.html -->
<!doctype html>
<html lang="en">
<head>
  {% load static %}
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NOMY • Intro</title>

  <!-- DM Sans -->
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet" />

  <style>
    :root{
      --ink:#1f003d;
      --muted:#4b3970;
      --card-bg:rgba(255,255,255,.15);
      --shadow:0 18px 40px rgba(17,12,40,.10);
    }

    *{box-sizing:border-box;}

    html,body{
      height:100%;
      margin:0;
      font-family:"DM Sans",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,Arial,sans-serif;
      color:var(--ink);
      background:url("{% static 'images/bg.png' %}") center center / cover no-repeat fixed;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding:8vh 4vw;
    }

    .story__progress{
      position:fixed;
      top:60px;
      left:50%;
      transform:translateX(-50%);
      display:flex;
      gap:8px;
      width:min(280px,60vw);
      z-index:10;
    }

    .bar{
      flex:1;
      height:6px;
      background:rgba(255,255,255,.4);
      border-radius:999px;
      overflow:hidden;
    }

    .bar__fill{
      height:100%;
      width:0%;
      background:var(--ink);
      border-radius:inherit;
      transition:width .25s ease;
    }

    .slides{
      width:min(720px,90vw);
      text-align:center;
    }

    .slide{
      display:none;
      animation:fade .35s ease;
    }

    .slide.is-active{
      display:block;
    }

    @keyframes fade{
      from{opacity:.001;transform:translateY(6px);}
      to{opacity:1;transform:none;}
    }

    /* ✨ Unified card styling */
    .card{
      position:relative;
      background:var(--card-bg);
      backdrop-filter:blur(10px);
      border-radius:24px;
      box-shadow:var(--shadow);
      padding:4rem 3rem;
      line-height:1.4;
      font-size:1rem;
      width:100%;
      max-width:700px;
      height:380px;                 /* fixed height across all slides */
      display:flex;
      flex-direction:column;
      justify-content:center;
      margin:0 auto;
      overflow:hidden;
    }

    .card::before{
      content:"";
      position:absolute;
      inset:0;
      border-radius:inherit;
      background:rgba(255,255,255,0.25);
      pointer-events:none;
      z-index:0;
    }

    .card p{
      margin:1.5rem 0;
      position:relative;
      z-index:1;
      color:var(--ink);
    }

    strong{
      font-weight:700;
    }

    .footer{
      position:fixed;
      bottom:20px;
      left:50%;
      transform:translateX(-50%);
      font-size:14px;
      color:var(--muted);
    }

    @media (max-width: 768px) {
      body {
        justify-content: flex-start;
        padding-top: 8vh;
      }

      .slides {
        overflow-y: auto;
        max-height: 100vh;
      }

      .card {
        padding: 3rem 1.5rem;
        height: 340px;  /* consistent smaller card for mobile */
      }
    }

    .tap{
      position:fixed;
      inset:0;
      display:grid;
      grid-template-columns:1fr 1fr;
      z-index:5;
    }

    .tap>button{
      background:none;
      border:0;
      padding:0;
      cursor:pointer;
    }
  </style>
</head>

<body>
  <div class="story__progress" id="progress"></div>

  <section class="slides" id="slides">
    <!-- Slide 1 -->
    <article class="slide is-active">
      <div class="card">
        <p>You’ve just entered a space built differently on purpose.</p>
        <p>A space that understands the quiet exhaustion of always trying to fit into systems that weren’t made with your mind in mind.</p>
        <p>Here, you don’t have to mask, explain or perform.</p>
        <p>You get to <strong>simply be</strong> and explore who that really is.</p>
      </div>
    </article>

    <!-- Slide 2 -->
    <article class="slide">
      <div class="card">
        <p><strong>NOMY</strong> is here to help you reconnect with yourself and meet yourself with understanding, maybe for the first time.</p>
        <p>Each feature here is a small, steady step toward something softer:</p>
        <p><strong>Emotionize</strong>: understand your feelings.<br>
           <strong>Dailies</strong>: set gentle goals for your day.<br>
           <strong>Toolkit</strong>: find calm when things feel too much.<br>
           <strong>Voice</strong>: create, reflect, and release.</p>
      </div>
    </article>

    <!-- Slide 3 -->
    <article class="slide">
      <div class="card">
        <p>As you explore, you’ll notice a quiet companion — your avatar — reflecting your state, growing calmer and more grounded as you do.</p>
        <p>It’s not here to judge or track you. It’s here to mirror what care looks like when it’s given to yourself.</p>
      </div>
    </article>

    <!-- Slide 4 -->
    <article class="slide">
      <div class="card">
        <p>Welcome home.</p>
      </div>
    </article>
  </section>

  <div class="tap" aria-hidden="true">
    <button id="prev" title="Previous"></button>
    <button id="next" title="Next"></button>
  </div>

  <div class="footer">Tap → to continue</div>

  <script>
    (function () {
      const slides = Array.from(document.querySelectorAll('.slide'));
      const progressRoot = document.getElementById('progress');
      const prevBtn = document.getElementById('prev');
      const nextBtn = document.getElementById('next');
      const footer = document.querySelector('.footer');
      if (!slides.length) return;

      // Build progress bars
      slides.forEach(() => {
        const bar = document.createElement('div');
        bar.className = 'bar';
        const fill = document.createElement('div');
        fill.className = 'bar__fill';
        bar.appendChild(fill);
        progressRoot.appendChild(bar);
      });

      const fills = Array.from(document.querySelectorAll('.bar__fill'));
      let i = 0;

      function render(n) {
        i = Math.max(0, Math.min(slides.length - 1, n));
        slides.forEach((el, idx) => el.classList.toggle('is-active', idx === i));
        fills.forEach((f, idx) => f.style.width = idx <= i ? '100%' : '0%');
        footer.textContent = i === slides.length - 1 ? 'Tap to enter NOMY' : 'Tap → to continue';
      }

      function next() {
        if (i === slides.length - 1) {
          window.location.href = "{% url 'nomy-options' %}";
        } else {
          render(i + 1);
        }
      }
      function prev() { render(i - 1); }

      nextBtn.addEventListener('click', next);
      prevBtn.addEventListener('click', prev);

      window.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowRight') next();
        if (e.key === 'ArrowLeft') prev();
      });

      // Swipe gesture
      let startX = null;
      window.addEventListener('touchstart', (e) => { startX = e.touches[0].clientX; }, { passive:true });
      window.addEventListener('touchend', (e) => {
        if (startX == null) return;
        const dx = e.changedTouches[0].clientX - startX;
        if (Math.abs(dx) > 40) (dx < 0 ? next() : prev());
        startX = null;
      });

      render(0);
    })();
  </script>
</body>
</html>
