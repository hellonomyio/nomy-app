<!doctype html>
<html lang="en">
<head>
  {% load static %}
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NOMY ‚Ä¢ Explore Emotions</title>

  <!-- DM Sans -->
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet" />

  <style>
    :root{
      --text:#22163c;
      --muted:#5e4f79;
      --chip:#efe9ff;
      --oval:#e9e9f4;
      --accent:#7e5bef;
      --ring:#e6e0f5;
      --shadow:0 10px 30px rgba(19,7,63,.08);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:'DM Sans', system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;
      color:var(--text);
      background:#fff;
      display:flex;
      align-items:flex-start;
      justify-content:center;
    }
    .wrap{
      width:100%;
      max-width:1100px;
      padding:clamp(60px,10vh,140px) 20px 80px;
      display:flex; flex-direction:column; gap:18px; align-items:center;
    }
    h1{margin:0;text-align:center;font-weight:800;font-size:clamp(22px,3.6vw,40px);line-height:1.25}
    .sub{margin:0;color:var(--muted);text-align:center;font-size:clamp(14px,1.8vw,18px)}

    .toolbar{
      margin-top:8px;
      display:flex; gap:12px; flex-wrap:wrap; justify-content:center; align-items:center;
      width:100%; max-width:880px;
    }
    .search{
      flex:1 1 320px;
      display:flex; align-items:center; gap:10px;
      border:1px solid var(--ring); border-radius:999px; padding:10px 14px; background:#fff;
      box-shadow:var(--shadow);
    }
    .search input{
      border:0; outline:0; width:100%; font:inherit; color:inherit; background:transparent;
    }

    .tabs{display:flex; gap:8px; flex-wrap:wrap; justify-content:center}
    .tab{
      border:1px solid var(--ring); background:#fff; padding:8px 12px; border-radius:999px;
      font-weight:600; cursor:pointer; user-select:none;
    }
    .tab[aria-selected="true"]{ background:var(--chip); border-color:transparent }

    .alpha{
      margin-top:6px; display:flex; gap:4px; flex-wrap:wrap; justify-content:center; color:var(--muted); font-size:14px;
    }
    .alpha a{ text-decoration:none; padding:4px 6px; border-radius:6px }
    .alpha a:hover{ background:#f7f5ff }

    .grid{
      margin-top:14px;
      width:100%;
      display:grid;
      grid-template-columns: repeat(3, minmax(240px, 1fr));
      gap:18px 24px;
      align-items:start;
    }
    @media (max-width:980px){ .grid{ grid-template-columns: repeat(2, minmax(220px,1fr)); } }
    @media (max-width:680px){ .grid{ grid-template-columns: 1fr; } }

    .group{
      background:#fff; border:1px solid var(--ring); border-radius:16px; padding:14px;
      box-shadow:var(--shadow);
    }
    .group h3{ margin:0 0 10px; font-size:18px }
    .count{ color:var(--muted); font-weight:600; margin-left:6px; }

    .list{ display:flex; flex-wrap:wrap; gap:10px }
    .pill{
      display:inline-flex; align-items:center; justify-content:center;
      padding:10px 14px; border-radius:999px; text-decoration:none; color:var(--text);
      background:var(--oval); font-weight:700; box-shadow:var(--shadow);
      transition:transform .12s ease, box-shadow .25s ease, filter .25s ease;
    }
    .pill:hover{ transform:translateY(-2px); box-shadow:0 16px 40px rgba(19,7,63,.14); filter:saturate(1.06) }
    .pill:active{ transform:translateY(-1px) }

    .back{
      margin-top:8px;
      text-decoration:none; font-weight:600; color:#3a2c6b; border:1px solid var(--ring);
      border-radius:999px; padding:10px 14px;
      box-shadow:0 6px 22px rgba(19,7,63,.06);
    }
    .back:hover{ background:#faf7ff }
    .empty{ color:var(--muted); text-align:center; margin-top:22px }
  </style>
</head>
<body>
  <main class="wrap">
    <h1>Explore more emotions</h1>
    <p class="sub">Pick one that feels most familiar - or just start anywhere.</p>

    <!-- controls -->
    <div class="toolbar" role="group" aria-label="Filters">
      <label class="search" aria-label="Search emotions">
        üîé
        <input id="q" type="search" placeholder="Search emotions‚Ä¶" autocomplete="off" />
      </label>
      <nav class="tabs" id="tabs" aria-label="Themes"></nav>
    </div>

    <div class="alpha" id="alpha"></div>

    <!-- content -->
    <section id="content" class="grid" aria-live="polite"></section>
    <div id="empty" class="empty" hidden>No results. Try another word or theme.</div>

    <a class="back" href="{% url 'emotionfy:emotionize-home' %}">‚Üê Back</a>
  </main>

  <script>
    // ---- Data: themes -> emotions (feel free to tweak/expand) ----
    const THEMES = [
      { key:"calm",  label:"Calm / Grounded",  items:["Calm","Peace","Relief","Content","Secure","Balanced","Soft","Present"] },
      { key:"energy",label:"Energy / Drive",   items:["Joy","Excited","Motivated","Curious","Playful","Proud","Inspired","Hopeful"] },
      { key:"reflect",label:"Reflective",      items:["Sad","Nostalgic","Grateful","Tender","Lonely","Melancholy","Moved","Yearning"] },
      { key:"challenge",label:"Challenging",   items:["Frustrated","Anxious","Overwhelmed","Irritated","Angry","Ashamed","Guilty","Jealous"] },
      { key:"tired", label:"Low Energy",       items:["Tired","Sleepy","Drained","Foggy","Heavy","Flat","Wired-but-tired"] },
      { key:"social", label:"Connection",      items:["Connected","Supported","Affectionate","Protective","Compassionate","Independent","Sensitive"] },
    ];

    // Build a flat index for search
    const INDEX = THEMES.flatMap(t => t.items.map(name => ({ name, theme: t.key })));

    // ---- Helpers ----
    const $ = s => document.querySelector(s);
    const $$ = s => Array.from(document.querySelectorAll(s));
    const slug = s => s.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');

    // ---- Build tabs ----
    const tabs = $("#tabs");
    THEMES.forEach((t,i)=>{
      const b = document.createElement("button");
      b.className = "tab";
      b.type = "button";
      b.dataset.theme = t.key;
      b.textContent = `${t.label}`;
      if (i===0) b.setAttribute("aria-selected","true");
      b.addEventListener("click", ()=>{
        $$(".tab").forEach(x=>x.setAttribute("aria-selected","false"));
        b.setAttribute("aria-selected","true");
        render();
      });
      tabs.appendChild(b);
    });

    // ---- Alphabet strip ----
    const alpha = $("#alpha");
    "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").forEach(ch=>{
      const a = document.createElement("a");
      a.href = "#";
      a.textContent = ch;
      a.addEventListener("click", (e)=>{
        e.preventDefault();
        $("#q").value = ch.toLowerCase();
        render();
      });
      alpha.appendChild(a);
    });

    // ---- Render groups ----
    const content = $("#content");
    const empty = $("#empty");
    $("#q").addEventListener("input", render);

    function activeThemeKey(){
      const sel = tabs.querySelector('[aria-selected="true"]');
      return sel ? sel.dataset.theme : THEMES[0].key;
    }

    function render(){
      const q = $("#q").value.trim().toLowerCase();
      const themeKey = activeThemeKey();
      content.innerHTML = "";

      // Filter themes: we show all themes, but filter their items
      let totalShown = 0;
      THEMES.forEach(t=>{
        // If a theme tab is selected, prefer it (but still show others if searching)
        const themeSelected = (t.key === themeKey);
        const inScope = q.length ? true : (t.key === themeKey);

        if (!inScope) return;

        const items = t.items
          .filter(name => name.toLowerCase().includes(q));

        if (!items.length) return;

        totalShown += items.length;

        const group = document.createElement("section");
        group.className = "group";
        const h = document.createElement("h3");
        h.innerHTML = `${t.label} <span class="count">(${items.length})</span>`;
        group.appendChild(h);

        const list = document.createElement("div");
        list.className = "list";
        items.forEach(name=>{
          const a = document.createElement("a");
          a.className = "pill";
          a.href = `{% url 'emotionfy:emotionize-home' %}?emotion=${slug(name)}`;
          a.setAttribute("aria-label", `Choose ${name}`);
          a.textContent = name;
          list.appendChild(a);
        });
        group.appendChild(list);
        content.appendChild(group);
      });

      empty.hidden = totalShown > 0;
    }

    render();
  </script>
</body>
</html>
