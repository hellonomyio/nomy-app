{% extends "base.html" %}
{% load static %}
{% block title %}NOMY ‚Ä¢ Dailies{% endblock %}
{% block content %}
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">

<style>
  .dailies-page {
    --bg:#ffffff;
    --oval:#e9c3f1;
    --text:#1f003d; /* use your consistent NOMY deep purple */
    --muted:#5e4f79;
    --shadow:0 18px 40px rgba(17,12,40,.10);
    --radius:26px;
    color:var(--text);
  }

  *{box-sizing:border-box}
  html,body{height:100%;margin:0;padding:0}
  body{
    font-family:'DM Sans',system-ui,-apple-system,'Segoe UI',Roboto,Arial,sans-serif;
    background:var(--bg);
    color:var(--text);
    display:flex;
    align-items:flex-start;
    justify-content:center;
  }

  main.wrap{
    max-width:1100px;
    width:100%;
    padding:clamp(72px,12vh,160px) 20px 80px;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:28px;
    position:relative;
  }

  h2{
    margin:0;
    text-align:center;
    font-weight:100;
    font-size:clamp(16px,2.8vw,32px);
    line-height:1;
    letter-spacing:.2px;
    position:relative;
  }
  /* gentle banner toast */
  .toast {
    position: fixed;
    bottom: 24px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(34,22,60,0.9);
    color: #fff;
    font-size: 15px;
    padding: 12px 28px;
    border-radius: 999px;
    box-shadow: 0 6px 18px rgba(17,12,40,.25);
    opacity: 0;
    pointer-events: none;
    transition: opacity .3s ease, transform .3s ease;
    z-index: 3000;
  }
  .toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(-4px);
  }

  /* i button beside heading */
  .info-btn{
    position:absolute;
    top:-4px;
    right:-36px;
    display:flex;
    align-items:center;
    justify-content:center;
    width:22px;
    height:22px;
    border-radius:50%;
    background:rgba(36,22,63,0.08);
    font-size:13px;
    font-weight:600;
    color:var(--text);
    cursor:pointer;
    transition:background .2s ease;
  }
  .info-btn:hover,
  .info-btn:focus{
    background:rgba(36,22,63,0.15);
    outline:none;
  }

  /* popup modal overlay */
  .info-modal{
    position:fixed;
    top:0;left:0;width:100%;height:100%;
    background:rgba(34,22,60,0.15);
    backdrop-filter:blur(6px);
    display:flex;
    align-items:center;
    justify-content:center;
    opacity:0;
    pointer-events:none;
    transition:opacity .25s ease;
    z-index:2000;
  }
  .info-modal.active{
    opacity:1;
    pointer-events:auto;
  }

  /* modal box */
  .modal-content {
    background:#f1f1ff;
    color:#1f003d; /* üíú fixed: always readable, even in dark mode */
    border-radius:20px;
    box-shadow:0 18px 40px rgba(17,12,40,.1);
    padding:36px 32px;
    max-width:480px;
    width:90%;
    text-align:left;
    line-height:1.7;
    font-size:16px;
  }

  .modal-content h3 {
    text-align:left;
    margin-top:0;
    font-weight:600;
    margin-bottom:18px;
    color:#1f003d; /* heading stays consistent too */
  }

  .modal-content p {
    margin-bottom:18px;
    color:#1f003d; /* all text inside modal is consistent */
  }

  .modal-content button {
    margin-top:20px;
    background:var(--oval);
    border:none;
    border-radius:999px;
    padding:10px 22px;
    font-family:'DM Sans',sans-serif;
    font-size:15px;
    color:#1f003d; /* üíú ensures visible text */
    cursor:pointer;
    box-shadow:0 6px 22px rgba(19,7,63,.08);
    transition:background .2s ease, transform .1s ease;
  }
  .modal-content button:hover {
    background:#e1dcf9;
    transform:translateY(-1px);
  }

  .sub{
    margin:0;
    text-align:center;
    color:var(--muted);
    font-size:clamp(14px,1.8vw,18px);
  }

  /* emotion grid */
  .grid{
    position:relative;
    margin-top:12px;
    width:100%;
    max-width:600px;
    display:grid;
    grid-template-columns:repeat(2,1fr);
    grid-template-rows:repeat(2,1fr);
    gap:40px;
    justify-items:center;
    align-items:center;
  }

  .oval{
    display:flex;
    align-items:center;
    justify-content:center;
    width:280px;
    height:110px;
    background:#e9c3f1;
    text-decoration:none;
    color:#22163c;
    font-weight:400;
    font-size:20px;
    border-radius:26px;
    box-shadow:0 18px 40px rgba(17,12,40,.10);
    transition:transform .12s ease,box-shadow .25s ease,filter .25s ease;
  }
  .oval:hover{
    transform:translateY(-2px);
    box-shadow:0 22px 48px rgba(17,12,40,.14);
    filter:saturate(1.05);
  }

  .oval.morning{background:#e1dcf9}
  .oval.evening{background:#564d74; color:#ffff}
  .oval.reflections{background:#f1f1ff}
  .oval.overview{background:#f4f5f7}

  .art{
    position:absolute;
    top:50%;left:50%;
    transform:translate(-50%,-50%);
    width:120px;
    height:auto;
    pointer-events:none;
    user-select:none;
  }

  .more{
    margin-top:12px;
    text-decoration:none;
    font-weight:200;
    color:#3a2c6b;
    border:1px solid #e6e0f5;
    border-radius:999px;
    padding:10px 14px;
    box-shadow:0 6px 22px rgba(19,7,63,.06);
    transition:transform .1s ease,box-shadow .2s ease,background .2s ease;
  }
  .more:hover{
    transform:translateY(-2px);
    box-shadow:0 12px 28px rgba(19,7,63,.10);
    background:#faf7ff;
  }

  @media(max-width:640px){
    .grid{grid-template-columns:1fr;gap:22px;}
    .art{position:static;transform:none;margin:12px auto;}
    .oval{width:min(80vw,320px);}
    .info-btn{right:-28px;top:-2px;}
    .modal-content{padding:28px 20px;font-size:15px;}
  }

  @media(prefers-reduced-motion:reduce){
    *{transition:none!important;}
  }
</style>

<main class="wrap dailies-page">
  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }}">{{ message }}</div>
    {% endfor %}
  {% endif %}

  <div style="position:relative;display:flex;align-items:center;justify-content:center;">
    <h2>Welcome to Your Dailies</h2>
    <button class="info-btn" id="openInfo" aria-label="About this page">i</button>
  </div>
  <p class="sub" id="greet">Good Morning</p>

  <section class="grid" aria-label="Emotion options">
    <a class="oval morning" href="{% url 'dailies:morningAffirmation' %}">Morning</a>
    <a class="oval evening" href="/dailies/evening">Evening</a>
    <a class="oval reflections" href="{% url 'dailies:dailies-story' %}">My Reflections</a>
    <a class="oval overview" href="{% url 'dailies:dailies-story' %}">My Weekly Overview</a>
  </section>
</main>

<!-- soft modal popup -->
<div class="info-modal" id="infoModal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
  <div class="modal-content">
    <h3 id="modalTitle" style="margin-top:0;font-weight:600;">About Dailies</h3>
    <p>Each morning, you‚Äôll be invited to write a short affirmation ‚Äî something that grounds or encourages you. 
      It might be as simple as ‚ÄúI‚Äôm allowed to take my time‚Äù or ‚ÄúI can begin gently today.‚Äù</p>

      <p>Then, you can set one main goal for the day and list any tasks or checklists that help you move toward it. 
      These don‚Äôt need to be big or complex ‚Äî we care about the small wins too.</p>

      <p>In the evening, Dailies will gently check in. You‚Äôll have space to reflect: how did the day feel? 
      What supported you? What felt too much? This builds emotional awareness and helps prevent burnout 
      by making your needs visible in daily patterns.</p>
    <button id="closeInfo" aria-label="Close information popup">Close</button>
  </div>
</div>

<script>
  // --- Time phase logic
  const now = new Date();
  const h = now.getHours();
  const isMorning = (h >= 4 && h < 14);
  const phase = isMorning ? "morning" : "evening";
  document.body.dataset.phase = phase;
  document.getElementById('greet').textContent =
    phase === "morning"
      ? "Good Morning"
      : "You've reached the quiet end of the day. Would you like to reflect on how things went?";

  // --- Gentle soft-guard
  const toast = document.getElementById('toast');
  let allowNextClickUntil = 0;
  function nudge(msg){
    toast.textContent = msg;
    toast.classList.add('show');
    setTimeout(()=> toast.classList.remove('show'),2200);
  }
  function softGuard(e,targetPhase){
    if(targetPhase===phase)return;
    const nowMs=Date.now();
    if(nowMs<allowNextClickUntil)return;
    e.preventDefault();
    allowNextClickUntil=nowMs+2500;
    nudge(`It's ${phase} now ‚Äî tap again to open your ${targetPhase} reflection.`);
  }
  document.querySelector('.oval.morning')?.addEventListener('click',(e)=>softGuard(e,'morning'));
  document.querySelector('.oval.evening')?.addEventListener('click',(e)=>softGuard(e,'evening'));

  // --- Modal logic
  const modal = document.getElementById('infoModal');
  document.getElementById('openInfo').addEventListener('click',()=> modal.classList.add('active'));
  document.getElementById('closeInfo').addEventListener('click',()=> modal.classList.remove('active'));
  modal.addEventListener('click',e=>{ if(e.target===modal) modal.classList.remove('active'); });
  document.addEventListener('keydown',e=>{ if(e.key==='Escape') modal.classList.remove('active'); });
</script>
{% endblock %}
