{% extends "base.html" %}
{% load static %}

{% block title %}Evening Dailies{% endblock %}

{% block content %}

<style>
/* -------------------------------------------------------------------------- */
/* PAGE-SCOPED STYLES ONLY — DOES NOT AFFECT NAVBAR OR OTHER PAGES            */
/* -------------------------------------------------------------------------- */

.evening-page {
  --bg:#564d74;
  --ink:#ffffff;
  --panel:#eaeaf5;
  --muted:#e9e3f5;
  --shadow:0 28px 70px rgba(0,0,0,.25);

  background: var(--bg);
  width: 100%;
  min-height: calc(100vh - 60px);
  padding: 120px 16px 80px;
  display: flex;
  justify-content: center;
  font-family: "DM Sans", sans-serif;
  color: var(--ink);
}

.evening-page main {
  width: min(760px, 92vw);
  text-align: center;
}

.evening-page h1 {
  margin: 20px 0 24px;
  color: #fff;
  font-weight: 700;
  font-size: clamp(20px, 3.2vw, 32px);
}

.evening-page .card {
  background: var(--panel);
  border-radius: 24px;
  box-shadow: var(--shadow);
}

.evening-page textarea {
  width: 100%;
  height: clamp(220px, 40vh, 320px);
  padding: 22px 20px;
  border: none;
  background: transparent;
  border-radius: 24px;
  color: #2e2840;
  font: 500 16px/1.5 "DM Sans", sans-serif;
  outline: none;
  resize: vertical;
}

.evening-page .hint {
  margin: 12px 0 40px;
  color: var(--muted);
  font-size: clamp(13px, 1.6vw, 16px);
}

.evening-page .actions {
  margin-top: 16px;
}

.evening-page button {
  appearance:none;
  border:0;
  cursor:pointer;
  padding:14px 22px;
  border-radius:999px;
  background:transparent;
  color:var(--ink);
  font:700 16px "DM Sans",sans-serif;
  box-shadow:0 0 0 2px rgba(255,255,255,.25);
  transition:transform .12s ease, background .2s ease, box-shadow .25s ease;
}

.evening-page button:hover {
  transform:translateY(-2px);
  background:rgba(255,255,255,.06);
  box-shadow:0 16px 40px rgba(0,0,0,.25);
}

main {
  padding-top: 0 !important;
}

.back-btn {
    position: fixed;
    top: 84px;
    left: 28px;
    text-decoration: none;
    font-size: 15px;
    font-weight: 400;
    color:white;
    background: transparent;
    border: 1px solid #e6e0f5;
    border-radius: 999px;
    padding: 8px 16px;
    box-shadow:0 0 0 2px rgba(255,255,255,.25);
    transition: transform .1s ease, box-shadow .2s ease, background .2s ease;
    z-index: 2000;
}

.back-btn:hover {
    transform:translateY(-2px);
    background:rgba(255,255,255,.06);
    box-shadow:0 16px 40px rgba(0,0,0,.25);
}
</style>

<a href="{% url 'dailies:dailies-home' %}" class="back-btn">← Dailies Menu</a>

<div class="evening-page">
  <main>
    <h1>Let’s check in, how did today go?</h1>

    <form id="eveningForm" novalidate>
      <div class="card">
        <textarea
          id="evening_reflection"
          name="reflection"
          placeholder="Write about your day…"
        ></textarea>
      </div>

      <p class="hint">
        What felt possible today?<br>
        What helped you feel more grounded?
      </p>

      <div class="actions">
        <button type="submit">Save to My Dailies</button>
      </div>
    </form>
  </main>
</div>

<script>

  const today = new Date().toLocaleDateString("en-GB");

  let all = JSON.parse(localStorage.getItem("nomy_dailies") || "[]");
  let todayEntry = all.find(e => e.date === today);

  // Prefill if already entered
  if (todayEntry && todayEntry.evening) {
      document.getElementById("evening_reflection").value = todayEntry.evening;
  }

  document.getElementById("eveningForm").addEventListener("submit", function(e) {
      e.preventDefault();

      const reflection = document.getElementById("evening_reflection").value.trim();
      if (!reflection)
          return alert("Please write something.");

      if (!todayEntry) {
          todayEntry = { date: today, evening: reflection };
          all.push(todayEntry);
      } else {
          todayEntry.evening = reflection;
      }

      localStorage.setItem("nomy_dailies", JSON.stringify(all));

      alert("Your evening reflection is saved. You can keep editing this page or return later.");

      // do not redirect
  });

</script>


{% endblock %}
