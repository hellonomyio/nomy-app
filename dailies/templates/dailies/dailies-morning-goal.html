{% extends "base.html" %}
{% load static %}

{% block title %}Morning Goal{% endblock %}

{% block content %}

<style>
    :root{
      --goal-bg:#ffffff;
      --goal-ink:#2e2840;
      --goal-muted:#6b647d;
      --goal-panel:#eaeaf5;
      --goal-shadow:0 24px 60px rgba(0,0,0,.10);
      --goal-radius:26px;
      --goal-lavender:#f4f1ff;
    }

    #goal-page {
      width:min(760px,92vw);
      margin:0 auto;
      padding:55px 20px 60px;
      text-align:center;
      font-family:"DM Sans",sans-serif;
    }

    #goal-page h1 {
      margin:0 0 12px;
      font-weight:600;
      font-size:clamp(26px,3.5vw,38px);
      color:var(--goal-ink);
    }

    #goal-page p.sub {
      margin:0 0 32px;
      color:var(--goal-muted);
      font-size:clamp(15px,1.6vw,18px);
    }

    .affirmation-summary{
      background:#faf7ff;
      border-radius:20px;
      padding:16px 20px;
      box-shadow:0 8px 24px rgba(0,0,0,.05);
      margin:0 auto 36px;
      max-width:520px;
      font-size:clamp(15px,1.4vw,18px);
      color:var(--goal-ink);
    }

    #goal {
      width:100%;
      height:clamp(220px,36vh,320px);
      padding:24px 20px;
      border:none;
      background:var(--goal-panel);
      border-radius:var(--goal-radius);
      box-shadow:var(--goal-shadow);
      color:var(--goal-ink);
      font:500 16px/1.5 "DM Sans",sans-serif;
      resize:vertical;
      outline:none;
    }

    .hint {
      margin-top:12px;
      color:var(--goal-muted);
      font-size:clamp(13px,1.4vw,16px);
    }

    .actions { 
      margin-top:48px; 
      display:flex;
      gap:12px;
      justify-content:center;
      flex-wrap:wrap;
    }

    #goal-page button {
      appearance:none;
      border:0;
      cursor:pointer;
      padding:14px 28px;
      border-radius:999px;
      font:700 16px "DM Sans",sans-serif;
      transition:transform .12s ease, box-shadow .25s ease, background .25s ease;
    }

    .primary-btn {
      background:var(--goal-lavender);
      color:var(--goal-ink);
      box-shadow:0 10px 24px rgba(0,0,0,.08);
    }

    .primary-btn:hover {
      transform:translateY(-2px);
      box-shadow:0 18px 40px rgba(0,0,0,.14);
      background:#efe9ff;
    }

    .skip-btn {
      background:transparent;
      color:var(--goal-muted);
      border:1px solid #d6d0ec;
      box-shadow:none;
    }

    .skip-btn:hover {
      background:#f8f6ff;
      border-color:#c3bddf;
      transform:translateY(-1px);
    }

    .back-btn {
      position: fixed;
      top: 84px;
      left: 28px;
      text-decoration: none;
      font-size: 15px;
      font-weight: 400;
      color: #3a2c6b;
      background: #fff;
      border: 1px solid #e6e0f5;
      border-radius: 999px;
      padding: 8px 16px;
      box-shadow: 0 6px 22px rgba(19,7,63,.06);
      transition: .1s;
      z-index: 2000;
    }

    .back-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 28px rgba(19,7,63,.10);
      background: #faf7ff;
    }
</style>

<a href="{% url 'dailies:morningAffirmation' %}" class="back-btn">‚Üê Morning Affirmation</a>

<main id="goal-page">
    <h1>Let‚Äôs set your focus</h1>
    <p class="sub">What‚Äôs one gentle thing you‚Äôd like to achieve today?</p>

    <div id="affirmationSummary" class="affirmation-summary"></div>

    <form id="goalForm">
      <textarea id="goal" placeholder="Write your goal for today‚Ä¶"></textarea>
      <p class="hint">Remember, no goal is too big or too small.</p>

      <div class="actions">
        <button type="submit" class="primary-btn">Save & next step ‚Üí</button>
        <button type="button" id="skipBtn" class="skip-btn">Skip for now</button>
      </div>

    </form>
</main>

<script>
  const today = new Date().toLocaleDateString("en-GB");
  const summaryBox = document.getElementById("affirmationSummary");

  let all = JSON.parse(localStorage.getItem("nomy_dailies") || "[]");
  let todayEntry = all.find(e => e.date === today);

  // Show today's affirmation if exists
  if (todayEntry && todayEntry.affirmation) {
      summaryBox.innerHTML = `You said earlier: <em>‚Äú${todayEntry.affirmation}‚Äù</em>`;
  } else {
      summaryBox.innerHTML = `<em>No affirmation found</em>`;
  }

  // Prefill goal if exists
  if (todayEntry && todayEntry.goal) {
      document.getElementById("goal").value = todayEntry.goal;
  }

  // SAVE & NEXT STEP
  document.getElementById('goalForm').addEventListener('submit', (e)=>{
    e.preventDefault();
    const goal = document.getElementById('goal').value.trim();
    if(!goal) return alert("Please write your goal üå±");

    if (!todayEntry) {
      todayEntry = { date: today, goal: goal };
      all.push(todayEntry);
    } else {
      todayEntry.goal = goal;
    }

    localStorage.setItem('nomy_dailies', JSON.stringify(all));

    window.location.href = "{% url 'dailies:morningChecklist' %}";
  });

  // SKIP BUTTON
  document.getElementById("skipBtn").addEventListener("click", () => {
      window.location.href = "{% url 'dailies:morningChecklist' %}";
  });
</script>

{% endblock %}
