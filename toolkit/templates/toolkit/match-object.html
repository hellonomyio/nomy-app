{% extends "base.html" %}
{% load static %}

{% block title %}Match Object{% endblock %}

{% block content %}
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet" />

<style>
:root {
  --ink:#1f003d;
  --muted:#5e4f79;
  --shadow:0 18px 40px rgba(17,12,40,.08);
  --radius:26px;
  --pill:#e9f0fa;
  --tile:#564d74;
}

*{box-sizing:border-box;margin:0;padding:0;}
body{
  font-family:'DM Sans',system-ui,-apple-system,'Segoe UI',Roboto,Arial,sans-serif;
  color:var(--ink);
  background: radial-gradient(circle at 50% 35%, #f9fbff 0%, #ffffff 90%);
  display:flex;
  flex-direction:column;
  align-items:center;
  min-height:100vh;
  overflow:hidden;
}

.back-btn {
  position: fixed;
  top: 84px;
  left: 28px;
  text-decoration: none;
  font-size: 15px;
  color: #3a2c6b;
  background: #fff;
  border: 1px solid #e6e0f5;
  border-radius: 999px;
  padding: 8px 16px;
  box-shadow: 0 6px 22px rgba(19,7,63,.06);
  transition: transform .1s ease;
  z-index: 2000;
}
.back-btn:hover { transform: translateY(-2px); }

.zoom-wrapper{
  transform:scale(0.85);
  transform-origin:top center;
  width:100%;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  text-align:center;
  gap:30px;
}

.oval{
  display:flex;
  align-items:center;
  justify-content:center;
  background:var(--pill);
  color:var(--ink);
  border-radius:var(--radius);
  height:70px;
  width:260px;
  font-size:19px;
  font-weight:500;
  box-shadow:var(--shadow);
}

.sub{
  font-size:17px;
  color:var(--muted);
  max-width:560px;
  line-height:1.6;
}

.grid{
  display:grid;
  grid-template-columns:repeat(4,90px);
  grid-gap:20px;
  justify-content:center;
}

.tile{
  width:90px;
  height:90px;
  border-radius:16px;
  background:var(--tile);
  cursor:pointer;
  transition:transform .2s ease, background .2s ease;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
  position:relative;
  font-size:48px;
  user-select:none;
  color:transparent;
}

.tile.revealed{
  color:white;
}

.tile.matched{
  outline: 4px solid #9ae29a;
  color:white;
}

#restartBtn{
  background:none;
  border:none;
  font-size:17px;
  font-weight:600;
  cursor:pointer;
  display:none;
}

@media(max-width:720px){
  .zoom-wrapper{transform:scale(1);}
}
</style>


<a href="{% url 'toolkit:toolkit-puzzles' %}" class="back-btn">‚Üê Puzzles</a>

<div class="zoom-wrapper">

  <div class="oval">Match Object</div>

  <p id="instructions" class="sub">
    Flip tiles and match identical emojis. Work at your own pace.
  </p>

  <div class="grid" id="grid"></div>

  <button id="restartBtn">Begin Again</button>

</div>


<script>
/* -----------------------------------------------------
   STEP 1 ‚Äì Emoji set (edit if you want different objects)
----------------------------------------------------- */

const emojiPool = [
  "ü¶ã", "üöó", "üè°", "üå∏",
  "üå≥", "‚öΩ", "üêà", "‚≠ê"
];

/* duplicate for pairs */
let tileset = [...emojiPool, ...emojiPool];

/* state */
let first = null;
let second = null;
let locked = false;

/* elements */
const grid = document.getElementById("grid");
const restartBtn = document.getElementById("restartBtn");

/* -----------------------------------------------------
   GAME
----------------------------------------------------- */

function shuffleTiles() {
  tileset.sort(() => Math.random() - 0.5);
}

function createTiles() {
  grid.innerHTML = "";

  tileset.forEach(symbol => {
    const tile = document.createElement("div");
    tile.className = "tile";
    tile.dataset.symbol = symbol;
    tile.textContent = symbol;

    tile.onclick = () => reveal(tile);

    grid.appendChild(tile);
  });
}

function reveal(tile) {
  if (locked || tile.classList.contains("matched") || tile === first) return;

  tile.classList.add("revealed");

  if (!first) {
    first = tile;
    return;
  }

  second = tile;
  locked = true;
  checkMatch();
}

function checkMatch() {
  if (first.dataset.symbol === second.dataset.symbol) {
    first.classList.add("matched");
    second.classList.add("matched");
    resetTurn();
    checkFinished();
  } else {
    setTimeout(() => {
      first.classList.remove("revealed");
      second.classList.remove("revealed");
      resetTurn();
    }, 800);
  }
}

function resetTurn() {
  [first, second, locked] = [null, null, false];
}

function checkFinished() {
  const allDone = [...document.querySelectorAll(".tile")]
    .every(t => t.classList.contains("matched"));

  if (allDone) {
    restartBtn.style.display = "inline";
  }
}

restartBtn.onclick = startGame;

function startGame() {
  restartBtn.style.display = "none";
  first = second = null;
  locked = false;
  shuffleTiles();
  createTiles();
}

window.onload = startGame;
</script>

{% endblock %}
