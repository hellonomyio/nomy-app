{% extends "base.html" %}
{% load static %}
{% block title %}Colour Match{% endblock %}
{% block content %}
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet" />

<style>
:root {
  --ink:#1f003d;
  --muted:#5e4f79;
  --shadow:0 18px 40px rgba(17,12,40,.08);
  --radius:26px;
  --pill:#e9f0fa;
  --navheight:60px;
  --tile:#3a2c6b;
}

/* Reset & base */
*{box-sizing:border-box;margin:0;padding:0;}
body{
  font-family:'DM Sans',system-ui,-apple-system,'Segoe UI',Roboto,Arial,sans-serif;
  color:var(--ink);
  background: radial-gradient(circle at 50% 35%, #f9fbff 0%, #ffffff 90%);
  display:flex;
  flex-direction:column;
  align-items:center;
  min-height:100vh;
  overflow:hidden;
}

/* ü´∂ Back button */
.back-btn {
  position: fixed;
  top: 84px;
  left: 28px;
  text-decoration: none;
  font-size: 15px;
  font-weight: 400;
  color: #3a2c6b;
  background: #fff;
  border: 1px solid #e6e0f5;
  border-radius: 999px;
  padding: 8px 16px;
  box-shadow: 0 6px 22px rgba(19,7,63,.06);
  transition: transform .1s ease, box-shadow .2s ease, background .2s ease;
  z-index: 2000;
}
.back-btn:hover,
.back-btn:focus {
  transform: translateY(-2px);
  box-shadow: 0 12px 28px rgba(19,7,63,.10);
  background: #faf7ff;
  outline: none;
}

/* Layout wrapper */
.zoom-wrapper{
  transform:scale(0.85);
  transform-origin:top center;
  width:100%;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  min-height:calc(100vh - var(--navheight));
  text-align:center;
  gap:50px;
}

.oval{
  display:flex;
  align-items:center;
  justify-content:center;
  background:var(--pill);
  color:var(--ink);
  border-radius:var(--radius);
  height:70px;
  width:240px;
  font-size:19px;
  font-weight:500;
  box-shadow:var(--shadow);
}

/* instructions */
p.sub{
  color:var(--muted);
  font-size:17px;
  line-height:1.6;
  max-width:560px;
}

/* grid */
.grid{
  display:grid;
  grid-template-columns:repeat(4,80px);
  grid-gap:20px;
  justify-content:center;
}
.tile{
  width:80px;
  height:80px;
  border-radius:50%;
  background:var(--tile);
  cursor:pointer;
  transition:background .4s ease, transform .2s ease;
}
.tile.revealed{transform:scale(1.05);}

/* button */
button{
  background:none;
  border:none;
  color:var(--ink);
  font-size:17px;
  font-weight:600;
  cursor:pointer;
  transition:opacity .2s ease;
}
button:hover{opacity:.7;}

/* Avatar */
.avatar{
  position:fixed;
  bottom:22px;
  left:100px;
  width:150px;
  opacity:.9;
  pointer-events:none;
  animation:sway 5s ease-in-out infinite;
}
@keyframes sway{0%,100%{transform:translateY(0)}50%{transform:translateY(-4px)}}

@media(max-width:720px){
  .zoom-wrapper{transform:scale(1);}
  .back-btn{top:76px;left:18px;font-size:14px;padding:6px 12px;}
  .avatar{width:80px;left:20px;bottom:16px;}
}
</style>

<!-- ‚¨ÖÔ∏è Back to Puzzles -->
<a href="{% url 'toolkit:toolkit-puzzles' %}" class="back-btn">‚Üê Back to Puzzles</a>

<div class="zoom-wrapper">
  <div class="oval">Colour Match</div>
  <div class="grid" id="grid"></div>
  <button id="revealBtn">Reveal Pattern</button>
</div>

<img src="{% static 'images/avatar.png' %}" alt="NOMY avatar" class="avatar"/>

<script>
const colours = [
  "#dfe8ff", // soft sky
  "#eaeaf5", // pale lavender
  "#f1dcf9", // pink-lilac
  "#f9d5d3", // warm blush
  "#fbeacc", // soft butter
  "#cde0ff", // periwinkle
  "#d2b2a3", // gentle clay brown
  "#e8bdbd"  // muted rose
];

// duplicate and shuffle
const tileset = [...colours, ...colours].sort(() => Math.random() - 0.5);
const grid = document.getElementById("grid");
const btn = document.getElementById("revealBtn");
const instr = document.getElementById("instructions");
let revealed = false;
let first = null, second = null, locked = false;

function createTiles(){
  grid.innerHTML = "";
  tileset.forEach((c, i)=>{
    const tile=document.createElement("div");
    tile.className="tile";
    tile.dataset.color=c;
    tile.dataset.index=i;
    grid.appendChild(tile);
  });
}
createTiles();

btn.addEventListener("click", ()=>{
  const tiles=document.querySelectorAll(".tile");
  if(!revealed){
    // Show full pattern briefly
    tiles.forEach(t=>t.style.background=t.dataset.color);
    instr.textContent="Here‚Äôs your pattern. Take a moment to notice the colours and where they sit.";
    btn.textContent="Start Game";
    revealed=true;
  }else{
    // Hide to start matching
    tiles.forEach(t=>t.style.background="var(--tile)");
    instr.textContent="Flip two tiles to see their colours. If they match, they‚Äôll stay face up.";
    btn.style.display="none";
    enablePlay();
  }
});

function enablePlay(){
  const tiles=document.querySelectorAll(".tile");
  tiles.forEach(t=>{
    t.addEventListener("click", ()=>{
      if(locked || t.classList.contains("matched") || t===first) return;
      t.style.background=t.dataset.color;
      t.classList.add("revealed");
      if(!first){first=t;}
      else{
        second=t;
        checkMatch();
      }
    });
  });
}

function checkMatch(){
  locked=true;
  if(first.dataset.color===second.dataset.color){
    first.classList.add("matched");
    second.classList.add("matched");
    reset();
  }else{
    setTimeout(()=>{
      first.style.background="var(--tile)";
      second.style.background="var(--tile)";
      first.classList.remove("revealed");
      second.classList.remove("revealed");
      reset();
    },900);
  }
}

function reset(){
  [first,second,locked]=[null,null,false];
}
</script>
{% endblock %}
