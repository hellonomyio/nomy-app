{% extends "base.html" %}
{% load static %}
{% block title %}Toolkit{% endblock %}
{% block content %}
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">

<style>
:root {
  --ink:#1f003d;
  --muted:#5e4f79;
  --shadow:0 18px 40px rgba(17,12,40,.10);
  --radius:26px;
  --navbar-height:60px;
  --glow:#ffe68a;

  --neutral-bg: radial-gradient(circle at 50% 35%, #f9fbff 0%, #ffffff 90%);
  --mental-bg: radial-gradient(circle at 50% 35%, #e9f0fa 0%, #ffffff 90%);
  --creative-bg: radial-gradient(circle at 50% 35%, #fff3d9 0%, #ffffff 90%);
  --physical-bg: radial-gradient(circle at 50% 35%, #ffeac4 0%, #ffffff 90%);
  --sensory-bg: radial-gradient(circle at 50% 35%, #edf7ee 0%, #ffffff 90%);
}

*{box-sizing:border-box;margin:0;padding:0}
body{
  background: var(--neutral-bg);
  transition: background 1.4s ease-in-out;
  color:var(--ink);
  font-family:'DM Sans',system-ui,-apple-system,'Segoe UI',Roboto,Arial,sans-serif;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
}
.zoom-wrapper{
  transform:scale(0.92);
  transform-origin:top center;
  width:100%;
  display:flex;
  flex-direction:column;
  align-items:center;
  min-height:calc(100vh - var(--navbar-height));
  justify-content:center;
}
main.wrap{
  max-width:900px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:70px;
  text-align:center;
}

h2{font-size:clamp(24px,2.5vw,34px);font-weight:500;color:var(--ink);}
.sub{color:var(--muted);font-size:clamp(15px,1.6vw,18px);margin-top:8px;max-width:600px;line-height:1.7;}

.grid{
  width:100%;
  display:grid;
  grid-template-columns:repeat(2,minmax(260px,360px));
  gap:60px 64px;
  justify-content:center;
}

/* reveal cards */
.card-reveal {
  position: relative;
  height: 110px;
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  background: #ffffff;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  font-weight: 500;
  color: var(--ink);
  cursor: pointer;
  transition: all 0.6s ease;
  overflow: hidden;
}
.card-reveal.open { height: 180px; background: #f9f9ff; box-shadow: 0 20px 50px rgba(17,12,40,0.08); }
.card-reveal .front-text { opacity: 1; transition: opacity 0.4s ease; }
.card-reveal.open .front-text { opacity: 0; }
.card-reveal .back-content {
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -40%) scale(0.96);
  opacity: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  transition: all 0.8s ease;
}
.card-reveal.open .back-content { transform: translate(-50%, -50%) scale(1); opacity: 1; }
.card-reveal .back-content a {
  background: #fff;
  padding: 8px 14px;
  border-radius: 12px;
  text-decoration: none;
  color: var(--ink);
  box-shadow: 0 4px 14px rgba(17,12,40,.08);
  font-size: 18px;
  font-weight: 500;
  transition: transform .15s ease, background .2s ease;
}
.card-reveal .back-content a:hover { transform: translateY(-2px); background: #f5f5ff; }

/* colours */
.card-reveal.mental { background: #e9f0fa; }
.card-reveal.creative { background: #fff8e7; }
.card-reveal.physical { background: #ffeccf; }
.card-reveal.sensory { background: #f4f8f3; }

/* üîí GREYED-OUT locked card styling (matches Emotionize) */
.locked-card {
  opacity: 0.65;
  cursor: default;
  filter: grayscale(0.35);
}
.locked-card:hover {
  transform: none !important;
  box-shadow: var(--shadow) !important;
  filter: grayscale(0.35) !important;
}

/* disable links inside */
.locked-card .back-content a {
  pointer-events: none;
  opacity: 0.5;
  filter: grayscale(1);
}

/* padlock */
.locked-card .padlock {
  position: absolute;
  top: 12px;
  right: 14px;
  width: 28px;
  opacity: 0.9;
}

/* avatar */
.avatar {
  position: fixed;
  bottom: 22px;
  left: 100px;
  width: 150px;
  height: auto;
  opacity: 0.95;
  pointer-events: none;
  z-index: 5;
  transform-origin: bottom center;
  animation: avatarSway 5s ease-in-out infinite;
  transition: transform 0.8s ease;
}
@keyframes avatarSway {
  0%,100% { transform: translateY(0) rotate(0deg); }
  50% { transform: translateY(-4px) rotate(1deg); }
}
.avatar.tilt { transform: rotate(5deg) translateY(-2px); }

.avatar::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(255,215,90,0.5) 0%, rgba(255,215,90,0.0) 70%);
  filter: blur(16px);
  transform: scale(1.3);
  animation: pleasantGlow 4s ease-in-out infinite;
  z-index: -1;
}

/* modal */
.modal-bg {
  position: fixed;
  inset: 0;
  backdrop-filter: blur(6px);
  background: rgba(0,0,0,.35);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}
.modal-box {
  background: white;
  padding: 28px 30px;
  border-radius: 22px;
  box-shadow: 0 14px 34px rgba(0,0,0,0.18);
  max-width: 320px;
  text-align: center;
  font-size: 16px;
  line-height: 1.45;
  color: var(--ink);
}
.modal-btn {
  margin-top: 20px;
  padding: 8px 18px;
  border-radius: 999px;
  border: none;
  background: #ece8ff;
  color: var(--ink);
  font-size: 15px;
}

/* breathing dot */
.breath-icon {
  width:16px;height:16px;background:#d3cbf9;border-radius:50%;
  margin:0 auto 14px auto;animation:inhale 3s ease-in-out infinite;
}
@keyframes inhale {
  0%,100% { transform:scale(1);opacity:0.7; }
  50% { transform:scale(1.2);opacity:1; }
}

@media(max-width:720px){
  .zoom-wrapper{transform:scale(1);}
  .grid{grid-template-columns:1fr;gap:22px;}
  .avatar{width:80px;left:20px;bottom:16px;}
}
  /* back button */
  .back-btn {
    position: fixed;
    top: 84px;
    left: 28px;
    text-decoration: none;
    font-size: 15px;
    font-weight: 400;
    color: #3a2c6b;
    background: #fff;
    border: 1px solid #e6e0f5;
    border-radius: 999px;
    padding: 8px 16px;
    box-shadow: 0 6px 22px rgba(19,7,63,.06);
    transition: transform .1s ease, box-shadow .2s ease, background .2s ease;
    z-index: 2000;
  }
  .back-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 28px rgba(19,7,63,.10);
    background: #faf7ff;
  }
</style>
<a href="{% url 'nomy-options' %}" class="back-btn">‚Üê Back to Main Menu</a>

<div class="zoom-wrapper">
  <main class="wrap">
    <div>
      <h2>Explore your tools</h2>
      <p class="sub">Find what helps you feel grounded, creative, or calm ‚Äî in your own way.</p>
    </div>

    <section class="grid" aria-label="Toolkit categories">

      <!-- MENTAL (unlocked) -->
      <div class="card-reveal mental" data-card="mental">
        <div class="front-text">Mental</div>
        <div class="back-content">
          <a href="{% url 'toolkit:toolkit-breathing' %}">Guided Breathing</a>
          <a href="{% url 'toolkit:toolkit-puzzles' %}">Puzzles</a>
        </div>
      </div>

      <!-- CREATIVE (locked + greyed) -->
      <div class="card-reveal creative locked-card" data-card="creative" onclick="openModal()">
        <img src="{% static 'images/padlock.png' %}" class="padlock" alt="">
        <div class="front-text">Creative</div>
        <div class="back-content">
          <a href="#">Colour</a>
          <a href="#">Doodle</a>
        </div>
      </div>

      <!-- PHYSICAL (locked + greyed) -->
      <div class="card-reveal physical locked-card" data-card="physical" onclick="openModal()">
        <img src="{% static 'images/padlock.png' %}" class="padlock" alt="">
        <div class="front-text">Physical</div>
        <div class="back-content">
          <a href="#">Body Check In</a>
          <a href="#">Untense</a>
        </div>
      </div>

      <!-- SENSORY (locked + greyed) -->
      <div class="card-reveal sensory locked-card" data-card="sensory" onclick="openModal()">
        <img src="{% static 'images/padlock.png' %}" class="padlock" alt="">
        <div class="front-text">Sensory</div>
        <div class="back-content">
          <a href="#">Sounds Tool</a>
          <a href="#">Grounding</a>
        </div>
      </div>

    </section>
  </main>
</div>

<!-- modal -->
<div class="modal-bg" id="modal">
  <div class="modal-box">
    Subscribe to unlock this tool
    <button class="modal-btn" onclick="closeModal()">Okay</button>
  </div>
</div>

<script>
const avatar = document.getElementById('avatar');
const body = document.body;

function openModal(){
  document.getElementById('modal').style.display = 'flex';
}
function closeModal(){
  document.getElementById('modal').style.display = 'none';
}

document.querySelectorAll('.card-reveal').forEach(card => {
  card.addEventListener('click', (e) => {

    const isLocked = card.classList.contains('locked-card');
    const isOpen = card.classList.contains('open');

    // CLOSE CARD
    if (isOpen) {
      card.classList.remove('open');

      const neutral = getComputedStyle(document.documentElement)
        .getPropertyValue(`--neutral-bg`);
      body.style.background = neutral;

      return;
    }

    // OPEN CARD
    document.querySelectorAll('.card-reveal.open')
      .forEach(c => c.classList.remove('open'));

    card.classList.add('open');

    avatar.classList.add('tilt');
    setTimeout(()=>avatar.classList.remove('tilt'),800);

    const bg = getComputedStyle(document.documentElement)
      .getPropertyValue(`--${card.dataset.card}-bg`);
    body.style.background = bg;

    if (isLocked) openModal();

  });
});
</script>

{% endblock %}
