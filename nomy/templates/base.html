<!doctype html>
<html lang="en">
<head>
  {% load static %}
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}NOMY{% endblock %}</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet" />
  <link rel="icon" type="image/png" sizes="32x32" href="{% static 'images/nomy_favicon_32x32.png' %}">
  <link rel="icon" type="image/png" sizes="64x64" href="{% static 'images/nomy_favicon_64x64.png' %}">

  <style>
  :root {
    --bg: #ffffff;
    --bg-alt: #f7f6fb;
    --text: #22163c;
    --muted: #5e4f79;
    --divider: #ece8f7;
    --shadow: 0 8px 30px rgba(17,12,40,.10);
    --hover: #f4f1ff;
    --navbar-bg: rgba(255,255,255,.95);
  }
  [data-theme="dark"] {
    --bg:#1c1728;
    --bg-alt:#28213b;
    --text:#ece8f7;
    --muted:#bcb6d7;
    --divider:#3c3553;
    --shadow:0 8px 30px rgba(0,0,0,.45);
    --hover:#2b2440;
    --navbar-bg:rgba(28,23,40,.9);
  }

  html, body {height:100%;margin:0;padding:0;}
  body {
    font-family:'DM Sans',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    color:var(--text);
    background:var(--bg);
    transition:background .4s ease,color .4s ease;
  }
  [data-theme="dark"] body {
    background: radial-gradient(circle at 50% 40%, #f1eeff 0%, #e8e3fa 100%);
  }

  /* Navbar */
  .site-navbar{
    position:fixed;top:0;left:0;right:0;
    background:var(--navbar-bg);
    box-shadow:var(--shadow);
    display:flex;justify-content:space-between;align-items:center;
    padding:12px clamp(16px,4vw,40px);
    z-index:2000;
    backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);
  }

  .logo{font-weight:700;font-size:20px;color:var(--text);text-decoration:none;}
  .links{display:flex;align-items:center;gap:26px;}
  .links a,
  .dropbtn,
  .user-btn{
    background:none;
    border:none;
    font:inherit;
    font-weight:500;
    color:var(--muted);
    text-decoration:none;
    cursor:pointer;
    transition:color .25s ease;
    display:flex;
    align-items:center;
    padding:0;
  }
  .links a:hover,
  .dropbtn:hover,
  .user-btn:hover{color:var(--text);}
  [data-theme="dark"] .links a,[data-theme="dark"] .dropbtn,[data-theme="dark"] .user-btn{color:#dcd7ee;}
  [data-theme="dark"] .links a:hover,[data-theme="dark"] .dropbtn:hover,[data-theme="dark"] .user-btn:hover{color:#ece8f7;}

  /* Dropdowns */
  .dropdown,
  .user-dropdown {
    position: relative;
  }

  .dropdown-content,
  .user-dropdown-content {
    display: none;
    position: absolute;
    top: 100%; /* sits directly below trigger */
    left: 0;
    background: var(--bg-alt);
    min-width: 200px;
    border-radius: 14px;
    box-shadow: var(--shadow);
    padding: 10px 0;
    opacity: 0;
    visibility: hidden;
    transition: opacity .15s ease, visibility .15s ease, transform .15s ease;
    transform: translateY(4px);
    z-index: 2500;
  }

  /* show user dropdown when .open class is applied */
  .user-dropdown.open .user-dropdown-content {
    display: block;
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  /* Hover open behaviour (no flicker) */
  .dropdown:hover .dropdown-content {
    display: block;
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .dropdown-content a,
  .user-dropdown-content a,
  .user-dropdown-content button {
    display: block;
    width: 100%;
    text-align: left;
    padding: 10px 18px;
    color: var(--text);
    background: none;
    border: none;
    font: inherit;
    cursor: pointer;
    text-decoration: none;
    transition: background .2s ease, color .2s ease;
  }

  .dropdown-content a:hover,
  .user-dropdown-content a:hover,
  .user-dropdown-content button:hover {
    background: var(--hover);
    color: var(--text);
  }

  .user-name{
    display:block;
    padding:8px 18px;
    font-weight:600;
    color:var(--muted);
    border-bottom:1px solid var(--divider);
    margin-bottom:6px;
  }

  .theme-toggle{
    margin-left:20px;
    background:none;
    border:none;
    cursor:pointer;
    color:var(--muted);
    font-size:18px;
    transition:color .2s ease;
  }
  .theme-toggle:hover{color:var(--text);}

  /* Sidebar */
  .hamburger{display:none;flex-direction:column;gap:5px;width:26px;height:24px;cursor:pointer;background:none;border:none;}
  .hamburger span{width:100%;height:3px;background:var(--text);border-radius:2px;transition:all .3s ease;}
  .hamburger.active span:nth-child(1){transform:translateY(8px) rotate(45deg);}
  .hamburger.active span:nth-child(2){opacity:0;}
  .hamburger.active span:nth-child(3){transform:translateY(-8px) rotate(-45deg);}

  @media(max-width:720px){
    .links{display:none;}
    .hamburger{display:flex;}
    .logo{display:none;}
    .site-navbar{justify-content:flex-start;gap:20px;padding:12px 20px;}
  }
  main{padding-top:80px;min-height:100vh;}
  </style>
</head>

<body>
  <nav class="site-navbar">
    <button class="hamburger" id="hamburger"><span></span><span></span><span></span></button>
    <a href="{% url 'nomy-options' %}" class="logo">NOMY</a>

    <div class="links">
      <a href="{% url 'emotionfy:emotionize-home' %}">Emotionize</a>

      <!-- Updated Dailies Dropdown -->
      <div class="dropdown" id="dailiesDropdown">
        <a href="{% url 'dailies:dailies-home' %}" class="dropbtn">Dailies â–¾</a>
        <div class="dropdown-content">
          <a href="{% url 'dailies:morningAffirmation' %}">Affirmations</a>
          <a href="{% url 'dailies:morningGoal' %}">Goals</a>
          <a href="{% url 'dailies:evening' %}">Reflections</a>
        </div>
      </div>

      <a href="{% url 'express:express-home' %}">Express</a>
      <a href="{% url 'toolkit:toolkit-home' %}">Toolkit</a>

      {% if user.is_authenticated %}
      <div class="user-dropdown" id="userDropdown">
        <button class="user-btn">{{ user.first_name|default:user.username }} â–¾</button>
        <div class="user-dropdown-content">
          <span class="user-name">{{ user.first_name|default:user.username }}</span>
          <a href="{% url 'nomy-settings' %}">Settings</a>
          <form method="post" action="{% url 'logout' %}">
            {% csrf_token %}
            <button type="submit">Log out</button>
          </form>
        </div>
      </div>
      {% else %}
      <a href="{% url 'login' %}">Log in</a>
      {% endif %}

      <button id="themeToggle" class="theme-toggle">ðŸŒ™</button>
    </div>
  </nav>

  <main>{% block content %}{% endblock %}</main>

  <script>
  // Sidebar toggle (mobile)
  const burger=document.getElementById('hamburger');
  if(burger){burger.addEventListener('click',()=>burger.classList.toggle('active'));}

  // Dropdown JS â€“ only needed for user dropdown (hover handled by CSS for Dailies)
  function setupDropdown(id){
    const el=document.getElementById(id);
    if(!el)return;
    const btn=el.querySelector('.user-btn');
    let hideTimeout;
    btn.addEventListener('click',e=>{
      e.stopPropagation();
      el.classList.toggle('open');
    });
    el.addEventListener('mouseenter',()=>clearTimeout(hideTimeout));
    el.addEventListener('mouseleave',()=>hideTimeout=setTimeout(()=>el.classList.remove('open'),250));
    document.addEventListener('click',e=>{
      if(!el.contains(e.target)) el.classList.remove('open');
    });
  }
  setupDropdown('userDropdown');

  // Theme toggle
  const themeToggle=document.getElementById('themeToggle');
  const root=document.documentElement;
  const saved=localStorage.getItem('theme');
  if(saved)root.setAttribute('data-theme',saved);
  else if(window.matchMedia('(prefers-color-scheme: dark)').matches)root.setAttribute('data-theme','dark');
  function updateIcon(){themeToggle.textContent=root.getAttribute('data-theme')==='dark'?'â˜€ï¸':'ðŸŒ™';}
  updateIcon();
  themeToggle.addEventListener('click',()=>{
    const next=root.getAttribute('data-theme')==='dark'?'light':'dark';
    root.setAttribute('data-theme',next);
    localStorage.setItem('theme',next);
    updateIcon();
  });
  </script>
</body>
</html>
